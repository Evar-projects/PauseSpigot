From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Permisos <ido@terrorist.services>
Date: Wed, 3 Aug 2022 20:21:28 -0300
Subject: [PATCH] Avoid item merge if stack size above max stack size


diff --git a/src/main/java/net/minecraft/server/EntityItem.java b/src/main/java/net/minecraft/server/EntityItem.java
index f05805ab2a0a24047088c9c6c07c15dc1846f39d..7fe3928339b083a98b1da1e93de8b8d24027cc72 100644
--- a/src/main/java/net/minecraft/server/EntityItem.java
+++ b/src/main/java/net/minecraft/server/EntityItem.java
@@ -146,6 +146,10 @@ public class EntityItem extends Entity {
     // Spigot end
 
     private void w() {
+        // Paper start - avoid item merge if stack size above max stack size
+        ItemStack stack = getItemStack();
+        if (stack.count >= stack.getMaxStackSize()) return;
+        // Paper end
         // Spigot start
         double radius = world.spigotConfig.itemMerge;
         Iterator iterator = this.world.a(EntityItem.class, this.getBoundingBox().grow(radius, radius, radius)).iterator();
